# 雙人對戰 3D 踩地雷遊戲 - 產品需求文件

## 產品概述

這是一款使用 Three.js 實現的雙人對戰 3D 踩地雷遊戲，透過 Socket.IO 進行即時多人連線。玩家輪流揭開格子，策略性地將風險傳遞給對手，踩到地雷者落敗。

## 核心遊戲規則

### 基本流程

1. **建立/加入房間**：房主建立房間並取得 6 位房間代碼，分享給對手加入
2. **遊戲開始**：雙方進入房間後自動開始，房主（Host）先手
3. **輪流行動**：玩家揭開格子，揭開至少 1 格後可傳遞回合給對手
4. **勝負判定**：踩到地雷者落敗

### 回合規則

| 規則 | 說明 |
|------|------|
| 揭開格子 | 點擊未揭開的格子顯示內容 |
| 傳遞條件 | 揭開至少 1 格後才能傳遞回合 |
| 回合時間 | 每回合 30 秒，超時自動揭開安全格並傳遞 |
| 首次安全 | 第一次點擊保證不會踩到地雷 |

### 勝利條件

| 條件 | 獲勝者 |
|------|--------|
| 對手踩到地雷 | 未踩雷的玩家 |
| 對手斷線 | 留在遊戲中的玩家 |
| 所有安全格揭開 | **最後傳遞回合的玩家** |
| 首回合超時 | 對手獲勝（未開局者判輸） |

### 計分規則

- 揭開格子獲得分數：每格 10 分
- 第一下開局格子不計分
- 分數僅供參考，不影響勝負判定

## 遊戲設定參數

| 參數 | 預設值 | 說明 |
|------|--------|------|
| 網格大小 | 10×10 | 遊戲區域大小 |
| 地雷數量 | 18 | 地雷總數 |
| 回合時間 | 30 秒 | 每回合時間限制 |
| 最少揭開數 | 1 格 | 傳遞回合前需揭開的最少格數 |

## 技術架構

### 前端

- **Three.js**：3D 場景渲染
- **Socket.IO Client**：即時通訊
- **原生 JavaScript (ES6+)**：遊戲邏輯

### 後端

- **Express.js**：HTTP 伺服器
- **Socket.IO**：WebSocket 即時通訊
- **ES Modules**：模組化架構

### 核心模組

```
├── index.html + script.js    # 前端遊戲介面
├── admin/                    # 後台管理系統
└── server/
    ├── index.js              # 伺服器入口
    ├── config.js             # 遊戲參數設定
    ├── gameEngine.js         # 遊戲邏輯引擎
    ├── roomManager.js        # 房間管理
    ├── socketHandler.js      # Socket 事件處理
    ├── adminAuth.js          # JWT 認證
    └── adminHandler.js       # 後台事件處理
```

## 特色功能

### 遊戲功能

- 🎲 **回合制對戰**：策略性傳遞回合
- 🌐 **即時連線**：房間代碼邀請對戰
- 🎨 **3D 視覺**：Three.js 渲染場景
- 💣 **爆炸特效**：踩雷時的動畫效果
- 🚩 **標記系統**：右鍵標記可疑位置
- ⏱️ **回合計時**：限時決策增加緊張感
- 🔄 **自動展開**：空白格自動展開相鄰安全區

### 後台管理

- 📊 **即時統計**：房間數量、玩家數、遊戲狀態
- 👁️ **觀戰功能**：上帝視角觀看進行中的遊戲
- 🔐 **JWT 認證**：安全的管理員登入機制

## 防作弊機制

- 前端不儲存地雷位置
- 所有遊戲操作經伺服器驗證
- 地雷資訊僅在遊戲結束後揭露

## 範例情境

### 情境一：正常對局

```
1. A 建立房間，B 加入
2. A（先手）揭開 3 格，傳遞給 B
3. B 揭開 2 格，傳遞給 A
4. A 揭開 1 格踩到地雷
5. B 獲勝
```

### 情境二：全部揭開

```
1. A 揭開格子，傳遞給 B（A 成為最後傳遞者）
2. B 揭開最後一個安全格
3. A 獲勝（因為 A 是最後傳遞回合的人）
```

### 情境三：超時處理

```
1. A 揭開格子後思考太久
2. 30 秒超時，系統自動揭開一個安全格
3. 回合自動傳遞給 B
```